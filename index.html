<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üé¨ IMBD - Dad's Magic Movie App</title>
    <script src="https://cdn.socket.io/4.7.2/socket.io.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #0f0f0f;
            color: white;
            line-height: 1.6;
        }

        /* Yellow IMDB Header */
        .imdbHeader {
            background: linear-gradient(135deg, #f5c518 0%, #f4d03f 100%);
            padding: 20px 0;
            position: sticky;
            top: 0;
            z-index: 1000;
            box-shadow: 0 4px 20px rgba(245, 197, 24, 0.3);
        }

        .headerContent {
            max-width: 1400px;
            margin: 0 auto;
            padding: 0 20px;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .imdbTitle {
            font-size: 2.5rem;
            font-weight: bold;
            color: #000;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.1);
        }

        .searchContainer {
            flex: 1;
            max-width: 500px;
            margin: 0 40px;
            position: relative;
        }

        .searchInput {
            width: 100%;
            padding: 15px 20px;
            border: none;
            border-radius: 25px;
            font-size: 1.1rem;
            background: rgba(255,255,255,0.9);
            color: #333;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }

        .searchInput:focus {
            outline: none;
            background: white;
            box-shadow: 0 4px 20px rgba(0,0,0,0.2);
        }



        .searchSpinner {
            position: absolute;
            right: 20px;
            top: 50%;
            transform: translateY(-50%);
        }





        /* Search Dropdown */
        .searchDropdownOverlay {
            position: absolute;
            top: 120px;
            left: 0;
            right: 0;
            z-index: 999999;
            pointer-events: none;
        }

        .searchDropdown {
            max-width: 500px;
            margin: 0 auto;
            background: #fff;
            border-radius: 12px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.3);
            max-height: 300px;
            overflow-y: auto;
            pointer-events: auto;
        }

        .searchResultItem {
            padding: 12px 20px;
            border-bottom: 1px solid #f0f0f0;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .searchResultItem:hover {
            background: #f8f9fa;
        }

        .searchResultTitle {
            font-size: 16px;
            color: #000;
            font-weight: 500;
            flex: 1;
        }

        .searchResultYear {
            font-size: 14px;
            color: #666;
            margin-left: 12px;
        }

        /* Main Content */
        .mainContent {
            max-width: 1400px;
            margin: 0 auto;
            padding: 30px 20px;
        }

        /* Featured Section */
        .featuredSection {
            margin-bottom: 30px;
            text-align: center;
            opacity: 0;
            transition: opacity 0.5s ease-in;
        }

        .featuredHeader {
            margin-bottom: 16px;
        }

        .featuredTitle {
            font-size: 24px;
            font-weight: bold;
            color: #fff;
            margin-bottom: 4px;
        }

        .featuredSubtitle {
            font-size: 14px;
            color: #888;
        }

        .featuredMovies {
            display: flex;
            gap: 16px;
            overflow-x: auto;
            padding: 20px 0;
            scrollbar-width: none;
        }

        .featuredMovies::-webkit-scrollbar {
            display: none;
        }

        /* Genre Sections */
        .genreSection {
            margin-bottom: 30px;
        }

        .genreHeader {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 16px;
        }

        .genreTitle {
            font-size: 22px;
            font-weight: bold;
            color: #fff;
        }

        .movieCount {
            font-size: 14px;
            color: #888;
        }

        .moviesRow {
            display: flex;
            gap: 16px;
            overflow-x: auto;
            padding: 20px 0;
            scrollbar-width: none;
        }

        .moviesRow::-webkit-scrollbar {
            display: none;
        }

        /* Movie Posters */
        .moviePoster {
            width: 156px;
            height: 234px;
            border-radius: 12px;
            overflow: hidden;
            position: relative;
            cursor: pointer;
            transition: transform 0.3s, box-shadow 0.3s;
            flex-shrink: 0;
        }

        .moviePoster:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 30px rgba(0,0,0,0.4);
        }

        .posterImage {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .ratingBadge {
            position: absolute;
            top: 8px;
            right: 8px;
            background: rgba(0,0,0,0.8);
            padding: 4px 8px;
            border-radius: 12px;
            border: 1px solid #FFD700;
        }

        .ratingText {
            font-size: 12px;
            font-weight: bold;
            color: #FFD700;
        }

        .posterOverlay {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            background: rgba(0,0,0,0.9);
            padding: 12px;
        }

        .movieTitle {
            font-size: 14px;
            font-weight: bold;
            color: #fff;
            text-align: center;
            line-height: 16px;
        }

        /* Movie Modal */
        .modal {
            display: none;
            position: fixed;
            z-index: 2000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.8);
            backdrop-filter: blur(5px);
            align-items: center;
            justify-content: center;
            padding: 20px;
            box-sizing: border-box;
        }

        .modalContent {
            background: linear-gradient(135deg, #1a1a1a 0%, #2d2d2d 100%);
            border-radius: 20px;
            padding: 30px;
            width: 100%;
            max-width: 600px;
            max-height: 90vh;
            overflow-y: auto;
            position: relative;
            border: 2px solid #f5c518;
            box-shadow: 0 20px 60px rgba(0,0,0,0.5);
            display: flex;
            flex-direction: column;
        }

        .closeButton {
            position: absolute;
            right: 20px;
            top: 20px;
            background: none;
            border: none;
            color: #f5c518;
            font-size: 24px;
            cursor: pointer;
            padding: 5px;
            border-radius: 50%;
            transition: background 0.2s;
        }

        .closeButton:hover {
            background: rgba(245, 197, 24, 0.1);
        }

        .modalHeader {
            margin-bottom: 20px;
        }

        .modalBody {
            display: flex;
            gap: 20px;
            align-items: flex-start;
            flex: 1;
        }

        @media (max-width: 768px) {
            .modalBody {
                flex-direction: column;
                align-items: center;
                text-align: center;
            }
        }

        .posterContainer {
            flex-shrink: 0;
        }

        .modalPosterImage {
            width: 150px;
            height: 225px;
            object-fit: cover;
            border-radius: 10px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        }

        .movieInfo {
            flex: 1;
        }

        .modalMovieTitle {
            font-size: 24px;
            font-weight: bold;
            color: #f5c518;
            margin-bottom: 15px;
            line-height: 1.2;
        }

        .metaInfo {
            display: flex;
            align-items: center;
            gap: 20px;
            margin-bottom: 20px;
        }

        .movieYear {
            font-size: 16px;
            color: #ccc;
        }

        .ratingContainer {
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .rating {
            font-size: 16px;
            color: #FFD700;
            font-weight: bold;
        }

        .overviewSection {
            margin-bottom: 20px;
        }

        .overviewTitle {
            font-size: 18px;
            font-weight: bold;
            color: #f5c518;
            margin-bottom: 10px;
        }

        .overviewText {
            font-size: 14px;
            color: #ccc;
            line-height: 1.6;
        }

        .detailsSection {
            margin-bottom: 20px;
        }

        .detailRow {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 8px;
        }

        .detailText {
            font-size: 14px;
            color: #ccc;
        }

        .actorsSection {
            margin-bottom: 20px;
        }

        .actorsTitle {
            font-size: 18px;
            font-weight: bold;
            color: #f5c518;
            margin-bottom: 10px;
        }

        .actorsList {
            list-style: none;
            padding: 0;
            margin: 0;
        }

        .actorItem {
            color: #ffffff;
            font-size: 14px;
            margin-bottom: 5px;
            padding: 0;
        }

        .modalActions {
            text-align: center;
            margin-top: 25px;
        }





        /* Loading */
        .loadingContainer {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100vh;
            gap: 20px;
        }

        .loadingText {
            font-size: 18px;
            color: #ccc;
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .headerContent {
                flex-direction: column;
                gap: 20px;
            }

            .searchContainer {
                margin: 0;
                max-width: 100%;
            }

            .modalBody {
                flex-direction: column;
                text-align: center;
            }

            .modalContent {
                width: 95%;
                margin: 10% auto;
                padding: 20px;
            }
        }
    </style>
</head>
<body>




    <!-- Yellow IMDB Header -->
    <header class="imdbHeader">
        <div class="headerContent">
            <div class="imdbTitle">IMBD</div>
            
            <div class="searchContainer">
                <input type="text" class="searchInput" placeholder="Search movies..." id="searchInput">
                <div class="searchSpinner" id="searchSpinner" style="display: none;">‚è≥</div>
            </div>
            

        </div>
    </header>

    <!-- Search Dropdown -->
    <div class="searchDropdownOverlay" id="searchDropdownOverlay" style="display: none;">
        <div class="searchDropdown" id="searchDropdown">
            <!-- Search results will appear here -->
        </div>
    </div>

    <!-- Main Content -->
    <main class="mainContent" id="mainContent">
        <!-- Loading State -->
        <div class="loadingContainer" id="loadingContainer">
            <div class="loadingText">Loading movies...</div>
        </div>

        <!-- Featured Movies Section -->
        <section class="featuredSection" id="featuredSection" style="display: none;">
            <div class="featuredHeader">
                <h2 class="featuredTitle">Featured Movies</h2>
                <p class="featuredSubtitle">Top 10 Highest-Rated Films of All Time</p>
            </div>
            <div class="featuredMovies" id="featuredMovies">
                <!-- Featured movies will be loaded here -->
            </div>
        </section>

        <!-- Genre Sections will be dynamically generated -->
        <div id="genreSections">
            <!-- Genre sections will be loaded here -->
        </div>
    </main>

    <!-- Movie Modal -->
    <div id="movieModal" class="modal">
        <div class="modalContent">
            <button class="closeButton" onclick="closeModal()">√ó</button>
            <div class="modalHeader">
                <!-- Modal header content -->
            </div>
            <div class="modalBody" id="modalBody">
                <!-- Modal content will be loaded here -->
            </div>

        </div>
    </div>



    <script>
        // Configuration
        const TMDB_API_KEY = '462b797169ca3170f8971775670b86ac'; // Your TMDB API key
        const TMDB_BASE_URL = 'https://api.themoviedb.org/3';
        // Try local socket server first, fallback to public server for Netlify
                const SOCKET_SERVER_URL = window.location.hostname === 'localhost' || window.location.hostname.includes('172.20.10.3')
            ? 'http://172.20.10.3:3001'
            : 'https://dad-magic-socket-server-production.up.railway.app';

        // State
        let genres = [];
        let moviesByGenre = {};
        let featuredMovies = [];
        let selectedMovie = null;
        let socket = null;
        let searchTimeout = null;

        // Initialize the app
        async function initApp() {
            try {
                // Load sample data first (with actors) for featured movies
                loadSampleData();
                
                // Then load genres and additional movies from TMDB
                await loadGenresAndMovies();
                setupSocket();
                setupSearch();
                hideLoading();
            } catch (error) {
                console.error('Error loading from TMDB:', error);
                // If TMDB fails, we still have the sample data
                hideLoading();
            }
        }

        // Load genres and movies from TMDB API
        async function loadGenresAndMovies() {
            try {
                console.log('Loading genres and movies from TMDB API...');
                console.log('TMDB API Key:', TMDB_API_KEY);
                console.log('TMDB Base URL:', TMDB_BASE_URL);
                
                // Don't overwrite featured movies - keep the ones with actors from loadSampleData()
                // Only load genres and genre movies

                // Load genres
                console.log('Fetching genres from TMDB...');
                const genresResponse = await fetch(`${TMDB_BASE_URL}/genre/movie/list?api_key=${TMDB_API_KEY}&language=en-US`);
                console.log('Genres response status:', genresResponse.status);
                const genresData = await genresResponse.json();
                console.log('Genres data:', genresData);
                
                // Filter and sort genres
                const priorityGenres = ['Action', 'Comedy', 'Drama', 'Thriller', 'Horror', 'Romance', 'Adventure', 'Sci-Fi', 'Animation', 'Fantasy'];
                genres = genresData.genres.filter(genre => 
                    priorityGenres.includes(genre.name) && 
                    genre.name !== 'Documentary' && 
                    genre.name !== 'TV Movie'
                ).sort((a, b) => {
                    const aPriority = priorityGenres.indexOf(a.name);
                    const bPriority = priorityGenres.indexOf(b.name);
                    return aPriority - bPriority;
                });

                // Load movies for each genre from TMDB API
                for (const genre of genres) {
                    try {
                        const moviesResponse = await fetch(`${TMDB_BASE_URL}/discover/movie?api_key=${TMDB_API_KEY}&language=en-US&sort_by=popularity.desc&include_adult=false&include_video=false&page=1&with_genres=${genre.id}`);
                        const moviesData = await moviesResponse.json();
                        
                        // Merge TMDB movies with existing sample data (if any)
                        const existingMovies = moviesByGenre[genre.id] || [];
                        const tmdbMovies = moviesData.results.slice(0, 20);
                        
                        // Combine and remove duplicates based on movie ID
                        const allMovies = [...existingMovies, ...tmdbMovies];
                        const uniqueMovies = allMovies.filter((movie, index, self) => 
                            index === self.findIndex(m => m.id === movie.id)
                        );
                        
                        moviesByGenre[genre.id] = uniqueMovies;
                        console.log(`Loaded ${tmdbMovies.length} TMDB movies for ${genre.name}`);
                    } catch (error) {
                        console.error(`Error loading movies for ${genre.name}:`, error);
                        // Keep existing movies if TMDB fails
                    }
                }

                renderGenreSections();
            } catch (error) {
                console.error('Error loading from TMDB:', error);
                throw error;
            }
        }

        // Load your exact priority movies from your backed-up app
        function loadSampleData() {
            // Featured Movies - Top 10 Highest-Rated Films of All Time
            featuredMovies = [
                {
                    id: 278,
                    title: "The Shawshank Redemption",
                    poster_path: "/q6y0Go1tsGEsmtFryDOJo3dEmqu.jpg",
                    vote_average: 9.3,
                    release_date: "1994-09-22",
                    overview: "Two imprisoned men bond over a number of years, finding solace and eventual redemption through acts of common decency.",
                    actors: ["Tim Robbins", "Morgan Freeman", "Bob Gunton"]
                },
                {
                    id: 238,
                    title: "The Godfather",
                    poster_path: "/3bhkrj58Vtu7enYsRolD1fZdja1.jpg",
                    vote_average: 9.2,
                    release_date: "1972-03-14",
                    overview: "The aging patriarch of an organized crime dynasty transfers control of his clandestine empire to his reluctant son.",
                    actors: ["Marlon Brando", "Al Pacino", "James Caan"]
                },
                {
                    id: 155,
                    title: "The Dark Knight",
                    poster_path: "/qJ2tW6WMUDux911r6m7haRef0WH.jpg",
                    vote_average: 9.0,
                    release_date: "2008-07-16",
                    overview: "When the menace known as the Joker wreaks havoc and chaos on the people of Gotham, Batman must accept one of the greatest psychological and physical tests of his ability to fight injustice.",
                    actors: ["Christian Bale", "Heath Ledger", "Aaron Eckhart"]
                },
                {
                    id: 680,
                    title: "Pulp Fiction",
                    poster_path: "/d5iIlFn5s0ImszYzBPb8JPIfbXD.jpg",
                    vote_average: 8.9,
                    release_date: "1994-10-14",
                    overview: "The lives of two mob hitmen, a boxer, a gangster and his wife, and a pair of diner bandits intertwine in four tales of violence and redemption.",
                    actors: ["John Travolta", "Samuel L. Jackson", "Uma Thurman"]
                },
                {
                    id: 13,
                    title: "Forrest Gump",
                    poster_path: "/saHP97rTPS5eLmrLQEcANmKrsFl.jpg",
                    vote_average: 8.8,
                    release_date: "1994-07-06",
                    overview: "The presidencies of Kennedy and Johnson, the Vietnam War, the Watergate scandal and other historical events unfold from the perspective of an Alabama man with an IQ of 75.",
                    actors: ["Tom Hanks", "Robin Wright", "Gary Sinise"]
                },
                {
                    id: 27205,
                    title: "Inception",
                    poster_path: "/9gk7adHYeDvHkCSEqAvQNLV5Uge.jpg",
                    vote_average: 8.8,
                    release_date: "2010-07-15",
                    overview: "A thief who steals corporate secrets through the use of dream-sharing technology is given the inverse task of planting an idea into the mind of a C.E.O.",
                    actors: ["Leonardo DiCaprio", "Joseph Gordon-Levitt", "Ellen Page"]
                },
                {
                    id: 603,
                    title: "The Matrix",
                    poster_path: "/f89U3ADr1oiB1s9GkdPOEpXUk5H.jpg",
                    vote_average: 8.7,
                    release_date: "1999-03-30",
                    overview: "A computer programmer discovers that reality as he knows it is a simulation created by machines, and joins a rebellion to break free.",
                    actors: ["Keanu Reeves", "Laurence Fishburne", "Carrie-Anne Moss"]
                },
                {
                    id: 769,
                    title: "Goodfellas",
                    poster_path: "/aKuFiU83sXISXLc5BD7k53mFFSU.jpg",
                    vote_average: 8.7,
                    release_date: "1990-09-12",
                    overview: "The story of Henry Hill and his life in the mob, covering his relationship with his wife Karen Hill and his mob partners Jimmy Conway and Tommy DeVito.",
                    actors: ["Robert De Niro", "Ray Liotta", "Joe Pesci"]
                },
                {
                    id: 98,
                    title: "Gladiator",
                    poster_path: "/6WBIuCWMmSS2bLu2u6XbVwu7cdn.jpg",
                    vote_average: 8.5,
                    release_date: "2000-05-01",
                    overview: "A former Roman General sets out to exact vengeance against the corrupt emperor who murdered his family and sent him into slavery.",
                    actors: ["Russell Crowe", "Joaquin Phoenix", "Connie Nielsen"]
                },
                {
                    id: 744,
                    title: "Top Gun",
                    poster_path: "/xu9zaAevzQ5nnrsXN6JcahjnG0S.jpg",
                    vote_average: 6.9,
                    release_date: "1986-05-16",
                    overview: "As students at the United States Navy's elite fighter weapons school compete to be best in the class, one daring young pilot learns a few things from a civilian instructor that are not taught in the classroom.",
                    actors: ["Tom Cruise", "Kelly McGillis", "Val Kilmer"]
                }
            ];

            // Your exact genre structure from the backed-up app
            genres = [
                { id: 28, name: "Action" },
                { id: 35, name: "Comedy" },
                { id: 18, name: "Drama" },
                { id: 27, name: "Horror" },
                { id: 10749, name: "Romance" },
                { id: 878, name: "Sci-Fi" },
                { id: 53, name: "Thriller" },
                { id: 80, name: "Crime" },
                { id: 12, name: "Adventure" },
                { id: 16, name: "Animation" },
                { id: 10751, name: "Family" },
                { id: 14, name: "Fantasy" },
                { id: 10402, name: "Musical" },
                { id: 10752, name: "War" }
            ];

            // Merge sample movies with existing TMDB data (if any)
            const existingMoviesByGenre = { ...moviesByGenre };
            
            // Add sample movies to existing data
            const sampleMoviesByGenre = {
                28: [ // Action
                    { id: 1771, title: "Captain America: The First Avenger", poster_path: "/vSNxAJTqDqGwnazKNVPUWLt8Xx.jpg", vote_average: 6.9, release_date: "2011-07-22", overview: "Steve Rogers, a rejected military soldier, transforms into Captain America after taking a dose of a 'Super-Soldier serum'. But being Captain America comes at a price as he attempts to take down a war monger and a terrorist organization.", actors: ["Chris Evans", "Hugo Weaving", "Tommy Lee Jones"] },
                    { id: 1366, title: "Rocky", poster_path: "/9Tf3QHd6Bi6BrdqC2RgVLBcvdT.jpg", vote_average: 8.0, release_date: "1976-11-21", overview: "When world heavyweight boxing champion, Apollo Creed, visits a local gym, he finds an unknown fighter, Rocky Balboa, whom he wants to face in an exhibition fight.", actors: ["Sylvester Stallone", "Talia Shire", "Burt Young"] },
                    { id: 98, title: "Gladiator", poster_path: "/6WBIuCWMmSS2bLu2u6XbVwu7cdn.jpg", vote_average: 8.5, release_date: "2000-05-01", overview: "A former Roman General sets out to exact vengeance against the corrupt emperor who murdered his family and sent him into slavery.", actors: ["Russell Crowe", "Joaquin Phoenix", "Connie Nielsen"] },
                    { id: 2501, title: "The Bourne Identity", poster_path: "/rmeLqyLsM2zQ0iKARu3TbplM9Q6.jpg", vote_average: 7.9, release_date: "2002-06-14", overview: "Wounded to the brink of death and suffering from amnesia, Jason Bourne is rescued at sea by a fisherman. With nothing to go on but a Swiss bank account number, he sets out to discover his true identity.", actors: ["Matt Damon", "Franka Potente", "Chris Cooper"] },
                ],
                35: [ // Comedy
                    { id: 1624, title: "Trading Places", poster_path: "/8xE3lbuWXwOCl4hhu67L3a0coKG.jpg", vote_average: 7.5, release_date: "1983-06-08", overview: "A snobbish investor and a wily street con artist find their positions reversed as part of a bet by two callous millionaires.", actors: ["Eddie Murphy", "Dan Aykroyd", "Jamie Lee Curtis"] },
                    { id: 808, title: "Shrek", poster_path: "/iB64vpL3dIObOtMZgX3RqdVdQc8.jpg", vote_average: 7.7, release_date: "2001-05-18", overview: "A mean lord exiles fairytale creatures to the swamp of a grumpy ogre, who must go on a quest and rescue a princess for the lord in order to get his land back.", actors: ["Mike Myers", "Eddie Murphy", "Cameron Diaz"] },
                ],
                18: [ // Drama
                    { id: 278, title: "The Shawshank Redemption", poster_path: "/q6y0Go1tsGEsmtFryDOJo3dEmqu.jpg", vote_average: 9.3, release_date: "1994-09-22", overview: "Two imprisoned men bond over a number of years, finding solace and eventual redemption through acts of common decency.", actors: ["Tim Robbins", "Morgan Freeman", "Bob Gunton"] },
                    { id: 238, title: "The Godfather", poster_path: "/3bhkrj58Vtu7enYsRolD1fZdja1.jpg", vote_average: 9.2, release_date: "1972-03-14", overview: "The aging patriarch of an organized crime dynasty transfers control of his clandestine empire to his reluctant son.", actors: ["Marlon Brando", "Al Pacino", "James Caan"] },
                    { id: 13, title: "Forrest Gump", poster_path: "/saHP97rTPS5eLmrLQEcANmKrsFl.jpg", vote_average: 8.8, release_date: "1994-07-06", overview: "The presidencies of Kennedy and Johnson, the Vietnam War, the Watergate scandal and other historical events unfold from the perspective of an Alabama man with an IQ of 75.", actors: ["Tom Hanks", "Robin Wright", "Gary Sinise"] },
                    { id: 106646, title: "The Wolf of Wall Street", poster_path: "/vxJ08SvwomfKbpQxC3xAncyD7r8.jpg", vote_average: 8.0, release_date: "2013-12-25", overview: "A New York stockbroker refuses to cooperate in a large securities fraud case involving corruption on Wall Street, corporate banking world and mob infiltration.", actors: ["Leonardo DiCaprio", "Jonah Hill", "Margot Robbie"] },
                ],
                27: [ // Horror
                    { id: 578, title: "Jaws", poster_path: "/l1yltvzILaZcx2jY7TpjMsqypI8.jpg", vote_average: 7.5, release_date: "1975-06-18", overview: "When an insatiable great white shark terrorizes the townspeople of Amity Island, the police chief, an oceanographer and a grizzled shark hunter seek to destroy the blood-thirsty beast.", actors: ["Roy Scheider", "Robert Shaw", "Richard Dreyfuss"] },
                    { id: 694, title: "The Shining", poster_path: "/9fghyNNdcRky9MqHjGiWGAcP8SO.jpg", vote_average: 8.4, release_date: "1980-05-23", overview: "Jack Torrance becomes winter caretaker at the isolated Overlook Hotel in Colorado, hoping to cure his writer's block. He settles in along with his wife, Wendy, and his son, Danny, who is plagued by psychic premonitions.", actors: ["Jack Nicholson", "Shelley Duvall", "Danny Lloyd"] },
                ],
                10749: [ // Romance
                    { id: 597, title: "Titanic", poster_path: "/9xjZS2rlVxm8SFx8kPC3aIGCOYQ.jpg", vote_average: 7.9, release_date: "1997-11-18", overview: "101-year-old Rose DeWitt Bukater tells the story of her life aboard the Titanic, 84 years later. A young Rose boards the ship with her mother and fianc√©. Meanwhile, Jack Dawson and Fabrizio De Rossi win third-class tickets aboard the ship.", actors: ["Leonardo DiCaprio", "Kate Winslet", "Billy Zane"] },
                    { id: 89, title: "Pretty Woman", poster_path: "/8uO0gT8H1d9XZbA5pOCzrW9vElq.jpg", vote_average: 7.1, release_date: "1990-03-23", overview: "A man in a legal but hurtful business needs an escort for some social events, and hires a beautiful prostitute he meets... only to fall in love.", actors: ["Richard Gere", "Julia Roberts", "Hector Elizondo"] }
                ],
                878: [ // Sci-Fi
                    { id: 603, title: "The Matrix", poster_path: "/f89U3ADr1oiB1s9GkdPOEpXUk5H.jpg", vote_average: 8.7, release_date: "1999-03-30", overview: "A computer programmer discovers that reality as he knows it is a simulation created by machines, and joins a rebellion to break free.", actors: ["Keanu Reeves", "Laurence Fishburne", "Carrie-Anne Moss"] },
                    { id: 27205, title: "Inception", poster_path: "/9gk7adHYeDvHkCSEqAvQNLV5Uge.jpg", vote_average: 8.8, release_date: "2010-07-15", overview: "A thief who steals corporate secrets through the use of dream-sharing technology is given the inverse task of planting an idea into the mind of a C.E.O.", actors: ["Leonardo DiCaprio", "Joseph Gordon-Levitt", "Ellen Page"] }
                ],
                53: [ // Thriller
                    { id: 550, title: "Fight Club", poster_path: "/pB8BM7pdSp6B6Ih7QZ4DrQ3PmJK.jpg", vote_average: 8.8, release_date: "1999-10-15", overview: "A nameless first person narrator attends support groups in attempt to subdue his emotional state and relieve his insomniac state. When he meets Marla, another fake attendee of support groups, his life seems to become a little more bearable.", actors: ["Brad Pitt", "Edward Norton", "Helena Bonham Carter"] },
                    { id: 475557, title: "Joker", poster_path: "/udDclJoHjfjb8fgsJuTGVUaOWC8.jpg", vote_average: 8.4, release_date: "2019-10-02", overview: "In Gotham City, mentally troubled comedian Arthur Fleck is disregarded and mistreated by society. He then embarks on a downward spiral of revolution and bloody crime. This path brings him face-to-face with his alter-ego: the Joker.", actors: ["Joaquin Phoenix", "Robert De Niro", "Zazie Beetz"] },
                ],
                80: [ // Crime
                    { id: 769, title: "Goodfellas", poster_path: "/aKuFiU83sXISXLc5BD7k53mFFSU.jpg", vote_average: 8.7, release_date: "1990-09-12", overview: "The story of Henry Hill and his life in the mob, covering his relationship with his wife Karen Hill and his mob partners Jimmy Conway and Tommy DeVito.", actors: ["Robert De Niro", "Ray Liotta", "Joe Pesci"] },
                    { id: 680, title: "Pulp Fiction", poster_path: "/d5iIlFn5s0ImszYzBPb8JPIfbXD.jpg", vote_average: 8.9, release_date: "1994-10-14", overview: "The lives of two mob hitmen, a boxer, a gangster and his wife, and a pair of diner bandits intertwine in four tales of violence and redemption.", actors: ["John Travolta", "Samuel L. Jackson", "Uma Thurman"] }
                ],
                16: [ // Animation
                    { id: 862, title: "Toy Story", poster_path: "/uXDfjJbdP4ijW5hWSBrPrlKpxab.jpg", vote_average: 8.3, release_date: "1995-10-30", overview: "Led by Woody, Andy's toys live happily in his room until Andy's birthday brings Buzz Lightyear onto the scene. Afraid of losing his place in Andy's heart, Woody plots against Buzz. But when circumstances separate Buzz and Woody from their owner, the duo eventually learns to put aside their differences.", actors: ["Tom Hanks", "Tim Allen", "Don Rickles"] },
                    { id: 12, title: "Finding Nemo", poster_path: "/7PyJcsBhpt9gEWzXy6Wz4ah6zL8.jpg", vote_average: 8.1, release_date: "2003-05-30", overview: "Nemo, an adventurous young clownfish, is unexpectedly taken from his Great Barrier Reef home to a dentist's office aquarium. It's up to his worrisome father Marlin and a friendly but forgetful fish Dory to bring Nemo home -- meeting vegetarian sharks, surfer dude turtles, hypnotic jellyfish, hungry seagulls, and more.", actors: ["Albert Brooks", "Ellen DeGeneres", "Alexander Gould"] }
                ]
            };

            // Merge sample movies with TMDB movies
            for (const [genreId, sampleMovies] of Object.entries(sampleMoviesByGenre)) {
                if (!moviesByGenre[genreId]) {
                    moviesByGenre[genreId] = [];
                }
                
                // Add sample movies to the beginning of each genre
                moviesByGenre[genreId] = [...sampleMovies, ...moviesByGenre[genreId]];
                
                // Remove duplicates based on movie ID
                moviesByGenre[genreId] = moviesByGenre[genreId].filter((movie, index, self) => 
                    index === self.findIndex(m => m.id === movie.id)
                );
            }

            renderFeaturedMovies();
            renderGenreSections();
        }

        // Render featured movies
        function renderFeaturedMovies() {
            const container = document.getElementById('featuredMovies');
            container.innerHTML = '';

            featuredMovies.forEach(movie => {
                const movieElement = createMoviePoster(movie);
                container.appendChild(movieElement);
            });

            // Show featured section smoothly without popup effect
            const featuredSection = document.getElementById('featuredSection');
            featuredSection.style.opacity = '0';
            featuredSection.style.display = 'block';
            // Smooth fade-in
            setTimeout(() => {
                featuredSection.style.transition = 'opacity 0.5s ease-in';
                featuredSection.style.opacity = '1';
            }, 100);
        }

        // Render genre sections
        function renderGenreSections() {
            const container = document.getElementById('genreSections');
            container.innerHTML = '';

            genres.forEach(genre => {
                const movies = moviesByGenre[genre.id] || [];
                if (movies.length === 0) return;

                const section = document.createElement('section');
                section.className = 'genreSection';
                section.innerHTML = `
                    <div class="genreHeader">
                        <h2 class="genreTitle">${genre.name}</h2>
                        <span class="movieCount">${movies.length} movies</span>
                    </div>
                    <div class="moviesRow" id="genre-${genre.id}">
                        <!-- Movies will be loaded here -->
                    </div>
                `;

                container.appendChild(section);

                // Load movies for this genre
                const moviesContainer = section.querySelector(`#genre-${genre.id}`);
                movies.forEach(movie => {
                    const movieElement = createMoviePoster(movie);
                    moviesContainer.appendChild(movieElement);
                });
            });
        }

        // Create movie poster element
        function createMoviePoster(movie) {
            const poster = document.createElement('div');
            poster.className = 'moviePoster';
            poster.onclick = () => showMovieModal(movie);

            const posterUrl = movie.poster_path 
                ? `https://image.tmdb.org/t/p/w500${movie.poster_path}`
                : 'https://via.placeholder.com/156x234/333/666?text=Movie';

            poster.innerHTML = `
                <img src="${posterUrl}" alt="${movie.title}" class="posterImage" 
                     onerror="this.src='https://via.placeholder.com/156x234/333/666?text=Movie'">
                ${movie.vote_average ? `
                    <div class="ratingBadge">
                        <span class="ratingText">‚òÖ ${movie.vote_average.toFixed(1)}</span>
                    </div>
                ` : ''}
                <div class="posterOverlay">
                    <div class="movieTitle">${movie.title}</div>
                </div>
            `;

            return poster;
        }

        // Show movie modal
        function showMovieModal(movie) {
            selectedMovie = movie;
            
            const modalBody = document.getElementById('modalBody');
            const posterUrl = movie.poster_path 
                ? `https://image.tmdb.org/t/p/w500${movie.poster_path}`
                : 'https://via.placeholder.com/150x225/333/666?text=Movie';

            modalBody.innerHTML = `
                <div class="posterContainer">
                    <img src="${posterUrl}" alt="${movie.title}" class="modalPosterImage"
                         onerror="this.src='https://via.placeholder.com/150x225/333/666?text=Movie'">
                </div>
                <div class="movieInfo">
                    <h2 class="modalMovieTitle">${movie.title}</h2>
                    <div class="metaInfo">
                        <span class="movieYear">${new Date(movie.release_date).getFullYear()}</span>
                        ${movie.vote_average ? `
                            <div class="ratingContainer">
                                <span class="rating">‚òÖ ${movie.vote_average.toFixed(1)}</span>
                            </div>
                        ` : ''}
                    </div>
                    ${movie.overview ? `
                        <div class="overviewSection">
                            <h3 class="overviewTitle">Overview</h3>
                            <p class="overviewText">${movie.overview}</p>
                        </div>
                    ` : ''}
                    ${movie.actors && movie.actors.length > 0 ? `
                        <div class="actorsSection">
                            <h3 class="actorsTitle">Starring</h3>
                            <ul class="actorsList">
                                ${movie.actors.map(actor => `
                                    <li class="actorItem">${actor}</li>
                                `).join('')}
                            </ul>
                        </div>
                    ` : ''}
                </div>
            `;

            const modal = document.getElementById('movieModal');
            modal.style.display = 'flex';
        }

        // Close modal
        function closeModal() {
            document.getElementById('movieModal').style.display = 'none';
            selectedMovie = null;
        }



        // Get genre name by ID
        function getGenreName(genreId) {
            const genre = genres.find(g => g.id === genreId);
            return genre ? genre.name : 'Unknown';
        }

        // Setup socket connection (silent - no UI indicators)
        function setupSocket() {
            socket = io(SOCKET_SERVER_URL);
            socket.on('connect', () => console.log('Connected to socket server'));
            socket.on('disconnect', () => console.log('Disconnected from socket server'));
        }

        // Setup search functionality
        function setupSearch() {
            const searchInput = document.getElementById('searchInput');
            
            searchInput.addEventListener('input', (e) => {
                const query = e.target.value.trim();
                
                if (searchTimeout) {
                    clearTimeout(searchTimeout);
                }

                if (query.length === 0) {
                    hideSearchDropdown();
                    return;
                }

                if (query.length < 2) {
                    hideSearchDropdown();
                    return;
                }

                // Show loading spinner
                document.getElementById('searchSpinner').style.display = 'block';

                searchTimeout = setTimeout(() => {
                    performSearch(query);
                }, 300);
            });

            // Hide dropdown when clicking outside
            document.addEventListener('click', (e) => {
                if (!e.target.closest('.searchContainer') && !e.target.closest('.searchDropdown')) {
                    hideSearchDropdown();
                }
            });
        }

        // Perform search
        async function performSearch(query) {
            try {
                const response = await fetch(`${TMDB_BASE_URL}/search/movie?api_key=${TMDB_API_KEY}&language=en-US&query=${encodeURIComponent(query)}&page=1&include_adult=false`);
                const data = await response.json();
                
                showSearchResults(data.results.slice(0, 8));
            } catch (error) {
                console.error('Search error:', error);
                showSearchResults([]);
            } finally {
                document.getElementById('searchSpinner').style.display = 'none';
            }
        }

        // Show search results
        function showSearchResults(results) {
            const dropdown = document.getElementById('searchDropdown');
            const overlay = document.getElementById('searchDropdownOverlay');

            if (results.length === 0) {
                dropdown.innerHTML = '<div class="searchResultItem"><span>No movies found</span></div>';
            } else {
                dropdown.innerHTML = results.map(movie => `
                    <div class="searchResultItem" onclick="selectMovieFromSearch(${JSON.stringify(movie).replace(/"/g, '&quot;')})">
                        <span class="searchResultTitle">${movie.title}</span>
                        <span class="searchResultYear">${new Date(movie.release_date).getFullYear()}</span>
                    </div>
                `).join('');
            }

            overlay.style.display = 'block';
        }

        // Hide search dropdown
        function hideSearchDropdown() {
            document.getElementById('searchDropdownOverlay').style.display = 'none';
        }

        // Select movie from search
        function selectMovieFromSearch(movie) {
            document.getElementById('searchInput').value = '';
            hideSearchDropdown();
            showMovieModal(movie);
        }

        // Hide loading
        function hideLoading() {
            document.getElementById('loadingContainer').style.display = 'none';
        }

        // Close modal when clicking outside
        window.onclick = function(event) {
            const modal = document.getElementById('movieModal');
            if (event.target === modal) {
                closeModal();
            }
        }

        // Initialize app when page loads
        document.addEventListener('DOMContentLoaded', initApp);
    </script>
</body>
</html>
